main.lst - generated by MGTEK Assembler ASM11 V1.26 Build 144 for WIN32 (x86) - Thu Dec 04 14:21:09 2025

    1:          =00000000              PRG_START   EQU $0000 ; Internal ROM start
    2:                                 
    3:          =00001000              PORTA       EQU $1000 ; PORTA controls OE'
    4:          =00001004              PORTB       EQU $1004 ; PORTB controls 2764 address lines
    5:          =00001003              PORTC       EQU $1003 ; PORTC receives data from 2764
    6:                                 
    7:                                 ; Serial communications
    8:                                 ; https://controls.ame.nd.edu/microcontroller/main/node25.html
    9:          =0000102E              SCSR        EQU $102E ; Status register, TDRE is bit 7
   10:          =0000102F              SCDR        EQU $102F
   11:                                 
   12:          =00000000                  ORG PRG_START
   13:     0000 4F                     START       CLRA
   14:                                                  
   15:     0001 B7 1004                LOOP        STAA PORTB ; Store address A4...A0
   16:                                 
   17:                                             ; Fastest 68HC11 instruction takes about 965ns
   18:                                             ; This is slow enough for 2764 t_OE <= 100ns + t_CE <= 250ns
   19:     0004 5F                                 CLRB
   20:     0005 F7 1000                            STAB PORTA ; Set CE' and OE' to LOW here
   21:     0008 4C                                 INCA
   22:                                             
   23:                                             ; DATA SHOULD BE VALID BY THIS POINT
   24:                                             
   25:                                             
   26:                                             
   27:     0009 F6 102E                WAIT_SCI_1  LDAB SCSR ; Get SCI status register
   28:     000C C4 80                              ANDB #$80 ; Bit mask of #$80 looks at bit 7 (TDRE) of SCSR
   29:     000E 27 F9                              BEQ WAIT_SCI_1 ; If TDRE == 0, go back and wait some more
   30:                                             
   31:     0010 C6 30                              LDAB #%00110000
   32:     0012 F7 1000                            STAB PORTA
   33:                                             
   34:     0015 F6 1003                            LDAB PORTC ; Read one byte from the EPROM 
   35:     0018 F7 102F                            STAB SCDR ; Writeback the byte to serial data register
   36:                                             
   37:                                             ; Wait for SCI transmit buffer to be empty (TDRE == 1)
   38:                                             ; This means byte was transmitted successfully
   39:     001B F6 102E                WAIT_SCI_2  LDAB SCSR ; Get SCI status register
   40:     001E C4 80                              ANDB #$80 ; Bit mask of #$80 looks at bit 7 (TDRE) of SCSR
   41:     0020 27 F9                              BEQ WAIT_SCI_2 ; If TDRE == 0, go back and wait some more
   42:                                             
   43:                                             ; Set OE' and CE' back to HIGH here
   44:                                             
   45:     0022 81 19                              CMPA #25
   46:     0024 26 DB                              BNE LOOP
   47:     0026 CF                                 STOP
