program.lst - generated by MGTEK Assembler ASM11 V1.26 Build 144 for WIN32 (x86) - Thu Dec 04 13:44:41 2025

    1:          =00000000              PRG_START   EQU $0000   ; Internal ROM start
    2:                                 
    3:          =00001000              PORTA       EQU $1000   ; PORTA controls OE'
    4:          =00001004              PORTB       EQU $1004   ; PORTB controls 2764 address lines
    5:          =00001003              PORTC       EQU $1003   ; PORTC receives/sends data from/to 2764
    6:          =00001007              DDRC        EQU $1007   ; PORTC direction pins
    7:                                 
    8:          =000000E0              DATA        EQU $00E0   ; Location to store 25 bytes in on-chip memory
    9:                                 
   10:          =000000E0                  ORG DATA
   11:                                             ; 25-element array for the data
   12:     00E0 AA BB CC DD EE AA      ARRAY       DB $AA, $BB, $CC, $DD, $EE, $AA, $BB, $CC, $DD, $EE
           00E6 BB CC DD EE 
   13:     00EA AA BB CC DD EE AA                  DB $AA, $BB, $CC, $DD, $EE, $AA, $BB, $CC, $DD, $EE
           00F0 BB CC DD EE 
   14:     00F4 AA BB CC DD EE                     DB $AA, $BB, $CC, $DD, $EE
   15:                                 
   16:          =00000000                  ORG PRG_START
   17:                                             ; Set PORTA. PROG_EN' and CE' are activated at program start.
   18:                                             ; Bit 6: PROG_EN = 1
   19:                                             ; Bit 5: CE' = 0
   20:                                             ; Bit 4: OE' = 1
   21:     0000 86 50                              LDAA #%01010000
   22:     0002 B7 1000                            STAA PORTA
   23:                                 
   24:     0005 CE 0000                            LDX #0
   25:     0008 E6 E0                  NEXT_DATA   LDAB DATA,X ; Get first byte to store...
   26:     000A F7 1003                            STAB PORTC  ; ...and place on PORTC
   27:                                 
   28:     000D FF 1004                            STX PORTB   ; Index X is also the target address on the 2764
   29:                                 
   30:     0010 86 FF                              LDAA #$FF
   31:     0012 B7 1007                            STAA DDRC   ; Set all PORTC pins to output
   32:                                 
   33:                                             ; By this point, HC11 is outputting data and adddress to the 2764
   34:                                 
   35:     0015 86 01                              LDAA #1     ; Start at n = 1
   36:     0017 36                     RETRY       PSHA        ; Push current n to stack
   37:                                 
   38:     0018 86 01                              LDAA #1     ; ] 1 ms
   39:     001A 8D 2B                              BSR PULSE   ; ] pulse
   40:                                             
   41:     001C 01                                 NOP
   42:     001D 01                                 NOP
   43:     001E 01                                 NOP
   44:     001F 01                                 NOP
   45:     0020 01                                 NOP
   46:                                 
   47:     0021 86 00                              LDAA #$00
   48:     0023 B7 1007                            STAA DDRC   ; Set all PORTC pins to input
   49:                                 
   50:     0026 32                                 PULA        ; Retrieve current n from stack
   51:                                 
   52:                                             ; By this point, ACCB has the actual data bit for reference
   53:                                             ; Compare against PORTC to verify
   54:                                 
   55:     0027 F1 1003                            CMPB PORTC
   56:     002A 27 07                              BEQ NEXT
   57:                                 
   58:     002C 4C                                 INCA        ; n++
   59:     002D 81 1A                              CMPA #26    ; n > 25
   60:     002F 27 0F                              BEQ FAIL
   61:                                 
   62:     0031 20 E4                              BRA RETRY
   63:                                 
   64:     0033 C6 03                  NEXT        LDAB #3     ; ACCB = 3, ACCA = n
   65:     0035 3D                                 MUL         ; D = 3*n
   66:     0036 16                                 TAB         ; ACCA = 3*n
   67:     0037 8D 0E                              BSR PULSE   ; 3*n ms pulse
   68:     0039 08                                 INX
   69:     003A 8C 0019                            CPX #25     ; Address > $18
   70:     003D 26 C9                              BNE NEXT_DATA
   71:                                 
   72:     003F 01                     SUCCESS     NOP
   73:                                 
   74:     0040 01                     FAIL        NOP
   75:                                 
   76:     0041 86 10                              LDAA #%00010000
   77:     0043 B7 1000                            STAA PORTA
   78:                                 
   79:     0046 CF                                 STOP
   80:                                 
   81:                                 ; ------------------------------------------------------------------------------
   82:                                 ; Subroutine PULSE
   83:                                 ; Sends an approx. n-ms pulse at bit 7 of PORTB
   84:                                 ; ((6 + (3 + (3 + 3) * 332 + 2 + 3) * 1) + 5 + 2 + 4) / 2 MHz ~= n ms
   85:                                 ;
   86:                                 ; Parameters:
   87:                                 ;   ACCA: Duration of pulse in ms
   88:                                 ; ------------------------------------------------------------------------------
   89:                                 
   90:     0047 36                     PULSE       PSHA            ; Save accumulators
   91:     0048 37                                 PSHB
   92:     0049 3C                                 PSHX
   93:     004A F6 1004                            LDAB PORTB      ; Save address lines
   94:     004D CA 80                              ORAB #$80       ; Set bit 7 to 1
   95:     004F F7 1004                            STAB PORTB
   96:     0052 8D 09                              BSR DELAY_1MS   ; 6 cycles
   97:     0054 C4 7F                              ANDB #$7F       ; 2 cycles --- reset bit 7
   98:     0056 F7 1004                            STAB PORTB      ; 4 cycles
   99:     0059 38                                 PULX
  100:     005A 33                                 PULB
  101:     005B 32                                 PULA
  102:     005C 39                                 RTS
  103:                                 
  104:     005D CE 014C                DELAY_1MS   LDX #332        ; 3 cycles
  105:     0060 09                     DELAY_LOOP  DEX             ; 3 cycles
  106:     0061 26 FD                              BNE DELAY_LOOP  ; 3 cycles
  107:     0063 4A                                 DECA            ; 2 cycles
  108:     0064 26 F7                              BNE DELAY_1MS   ; 3 cycles
  109:     0066 39                                 RTS             ; 5 cycles
  110:                                 
